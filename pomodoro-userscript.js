var __defProp=Object.defineProperty,__defNormalProp=(l,m,f)=>m in l?__defProp(l,m,{enumerable:!0,configurable:!0,writable:!0,value:f}):l[m]=f,__publicField=(l,m,f)=>(__defNormalProp(l,typeof m!="symbol"?m+"":m,f),f),__accessCheck=(l,m,f)=>{if(!m.has(l))throw TypeError("Cannot "+f)},__privateGet=(l,m,f)=>(__accessCheck(l,m,"read from private field"),f?f.call(l):m.get(l)),__privateAdd=(l,m,f)=>{if(m.has(l))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(l):m.set(l,f)},__privateSet=(l,m,f,b)=>(__accessCheck(l,m,"write to private field"),b?b.call(l,f):m.set(l,f),f);(function(){var l;const m=a=>(e,t)=>(a.set(e,t),t),f=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,b=536870912,C=b*2,F=(a,e)=>t=>{const s=e.get(t);let n=s===void 0?t.size:s<C?s+1:0;if(!t.has(n))return a(t,n);if(t.size<b){for(;t.has(n);)n=Math.floor(Math.random()*C);return a(t,n)}if(t.size>f)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;t.has(n);)n=Math.floor(Math.random()*f);return a(t,n)},N=new WeakMap,O=m(N),x=F(O,N),D=a=>a.method!==void 0&&a.method==="call",R=a=>a.error===null&&typeof a.id=="number",S=((a,e)=>{let t=null;return()=>{if(t!==null)return t;const s=new Blob([e],{type:"application/javascript; charset=utf-8"}),n=URL.createObjectURL(s);return t=a(n),setTimeout(()=>URL.revokeObjectURL(n)),t}})(a=>{const e=new Map([[0,()=>{}]]),t=new Map([[0,()=>{}]]),s=new Map,n=new Worker(a);return n.addEventListener("message",({data:c})=>{if(D(c)){const{params:{timerId:i,timerType:u}}=c;if(u==="interval"){const o=e.get(i);if(typeof o=="number"){const r=s.get(o);if(r===void 0||r.timerId!==i||r.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof o<"u")o();else throw new Error("The timer is in an undefined state.")}else if(u==="timeout"){const o=t.get(i);if(typeof o=="number"){const r=s.get(o);if(r===void 0||r.timerId!==i||r.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof o<"u")o(),t.delete(i);else throw new Error("The timer is in an undefined state.")}}else if(R(c)){const{id:i}=c,u=s.get(i);if(u===void 0)throw new Error("The timer is in an undefined state.");const{timerId:o,timerType:r}=u;s.delete(i),r==="interval"?e.delete(o):t.delete(o)}else{const{error:{message:i}}=c;throw new Error(i)}}),{clearInterval:c=>{const i=x(s);s.set(i,{timerId:c,timerType:"interval"}),e.set(c,i),n.postMessage({id:i,method:"clear",params:{timerId:c,timerType:"interval"}})},clearTimeout:c=>{const i=x(s);s.set(i,{timerId:c,timerType:"timeout"}),t.set(c,i),n.postMessage({id:i,method:"clear",params:{timerId:c,timerType:"timeout"}})},setInterval:(c,i)=>{const u=x(e);return e.set(u,()=>{c(),typeof e.get(u)=="function"&&n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:u,timerType:"interval"}})}),n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:u,timerType:"interval"}}),u},setTimeout:(c,i)=>{const u=x(t);return t.set(u,c),n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:u,timerType:"timeout"}}),u}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),V=a=>S().clearInterval(a),z=(a,e)=>S().setInterval(a,e);class P{constructor(){__privateAdd(this,l,{})}on(e,t){const s=__privateGet(this,l)[e];return s?s.push(t):__privateGet(this,l)[e]=[t],this}addListener(e,t){return this.on(e,t)}once(e,t){const s=(...n)=>{this.off(e,s),t(...n)};return this.on(e,s),this}emit(e,...t){const s=__privateGet(this,l)[e]||[];for(let n=0;n<s.length;n++)s[n](...t);return!!s.length}off(e,t){return __privateGet(this,l)[e]&&(__privateGet(this,l)[e]=__privateGet(this,l)[e].filter(s=>s!==t)),this}removeListener(e,t){return this.off(e,t)}removeAllListeners(e){return e?delete __privateGet(this,l)[e]:__privateSet(this,l,{}),this}eventNames(){return Reflect.ownKeys(__privateGet(this,l))}listeners(e){return __privateGet(this,l)[e]}listenerCount(e){var t;return((t=__privateGet(this,l)[e])==null?void 0:t.length)??0}}l=new WeakMap;const M=new P;class U{constructor(){__publicField(this,"interval"),__publicField(this,"minutes"),__publicField(this,"seconds")}setTime({minutes:e,seconds:t}){this.minutes=e,this.seconds=t}start(){this.stop(),this.interval=z(()=>this.tick(),1e3)}stop(){this.interval&&(V(this.interval),this.interval=null)}tick(){this.seconds--,this.minutes>0&&this.seconds<0&&(this.seconds=59,this.minutes--),this.minutes===0&&this.seconds===0&&M.emit("timer_stop"),M.emit("timer_tick",{minutes:this.minutes,seconds:this.seconds})}}function I(a,e,...t){const s=document.createElement(a);return typeof e=="string"?s.append(W(e)):Array.isArray(e)?s.append(...e):(Object.assign(s,e),Object.assign(s.style,e?.style)),t.length&&s.append(...t),s}function W(a){return document.createTextNode(a)}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var A={exports:{}};(function(a,e){(function(t,s){a.exports=s()})(B,function(){return function(t){function s(d){if(n[d])return n[d].exports;var g=n[d]={exports:{},id:d,loaded:!1};return t[d].call(g.exports,g,g.exports,s),g.loaded=!0,g.exports}var n={};return s.m=t,s.c=n,s.p="",s(0)}([function(t,s,n){function d(h){return h&&h.__esModule?h:{default:h}}var g=n(1),T=d(g);t.exports=T.default},function(t,s,n){function d(o,r){if(!(o instanceof r))throw new TypeError("Cannot call a class as a function")}function g(){var o=this,r=this.el,p=this.opts||i,y={};if(r.style.position="absolute",this.handle=p.handle||r,p.constrain){for(var w=p.relativeTo||r.parentNode,v=r,E=0,L=0;v!==w;)v=v.parentNode,(0,T.isRelative)(v)&&(E-=v.offsetLeft,L-=v.offsetTop),v===w&&(E+=v.offsetLeft,L+=v.offsetTop);var Z=E+w.offsetWidth-r.offsetWidth,Q=L+w.offsetHeight-r.offsetHeight;y.xClamp=(0,T.generateClamp)(E,Z),y.yClamp=(0,T.generateClamp)(L,Q)}this.opts=p,this.data=y,this.events={mousedown:h.mousedown.bind(this),mouseup:h.mouseup.bind(this),touchstart:h.touchstart.bind(this),touchstop:h.touchstop.bind(this),scrollFix:function(ee){o.isDragging&&ee.preventDefault()}},this.handleMove=c(this.opts.customMove),this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1),document.addEventListener("touchmove",this.events.scrollFix,{passive:!1})}Object.defineProperty(s,"__esModule",{value:!0});var T=n(2),h=n(3),c=(0,T.generateMoveFn)(),i={constrain:!1,relativeTo:null,handle:null,ignoreFn:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null,customMove:null},u=function(){function o(r,p){if(d(this,o),!r)throw Error("Must include moveable element");this.el=r,this.opts=p,g.call(this)}return o.prototype.reinit=function(){this.destroy(),g.call(this)},o.prototype.destroy=function(){var r=this.events;this.handle.removeEventListener("mousedown",r.mousedown,!1),document.removeEventListener("mousemove",r.mousemove,!1),document.removeEventListener("mouseup",r.mouseup,!1),this.handle.removeEventListener("touchstart",r.touchstart,!1),document.removeEventListener("touchmove",r.touchmove,!1),document.removeEventListener("touchstop",r.touchstop,!1),document.removeEventListener("touchmove",this.events.scrollFix,{passive:!1})},o}();s.default=function(o,r){return new u(o,r)}},function(t,s){function n(h,c){return function(i){return Math.min(Math.max(i,h),c)}}function d(h){return window.getComputedStyle(h).position==="relative"}function g(){return window.requestAnimationFrame?function(h){var c=h||T;return function(i,u,o){window.requestAnimationFrame(function(){c(i,u,o)})}}:function(h){return function(c,i,u){var o=h||T;o(c,i,u)}}}function T(h,c,i){h.style.left=c+"px",h.style.top=i+"px"}Object.defineProperty(s,"__esModule",{value:!0}),s.generateClamp=n,s.isRelative=d,s.generateMoveFn=g},function(t,s){function n(i){var u=this.opts;if(u.highlightInputs){var o=i.target.tagName.toLowerCase();if(o==="input"||o==="textarea")return}if(!u.ignoreFn||!u.ignoreFn(i)){if(i.button===0){var r=this.el,p=this.events;typeof u.onMouseDown=="function"&&u.onMouseDown(r,i);var y=i.clientX-r.offsetLeft,w=i.clientY-r.offsetTop;p.mousemove=d.bind(this,y,w),document.addEventListener("mousemove",p.mousemove,!1),document.addEventListener("mouseup",p.mouseup,!1)}i.preventDefault()}}function d(i,u,o){var r=this.el,p=this.opts,y=this.data;typeof p.onMouseMove=="function"&&p.onMouseMove(r,o);var w=o.clientX-i,v=o.clientY-u;return p.constrain&&(w=y.xClamp(w),v=y.yClamp(v)),this.handleMove(r,w,v),o.preventDefault(),!1}function g(i){var u=this.el,o=this.opts,r=this.events;typeof o.onMouseUp=="function"&&o.onMouseUp(u,i),document.removeEventListener("mouseup",r.mouseup,!1),document.removeEventListener("mousemove",r.mousemove,!1)}function T(i){var u=this.opts;if(u.highlightInputs){var o=i.target.tagName.toLowerCase();if(o==="input"||o==="textarea")return}if(!u.ignoreFn||!u.ignoreFn(i)){var r=this.el,p=this.events;typeof u.onTouchStart=="function"&&u.onTouchStart(r,i);var y=i.targetTouches[0],w=y.clientX-r.offsetLeft,v=y.clientY-r.offsetTop;p.touchmove=h.bind(this,w,v),this.isDragging=!0,document.addEventListener("touchmove",p.touchmove,!1),document.addEventListener("touchend",p.touchstop,!1),document.addEventListener("touchcancel",p.touchstop,!1)}}function h(i,u,o){var r=this.el,p=this.opts,y=this.data;typeof p.onTouchMove=="function"&&p.onTouchMove(r,o);var w=o.targetTouches[0],v=w.clientX-i,E=w.clientY-u;return p.constrain&&(v=y.xClamp(v),E=y.yClamp(E)),this.handleMove(r,v,E),o.preventDefault(),!1}function c(i){this.isDragging=!1;var u=this.el,o=this.opts,r=this.events;typeof o.onTouchStop=="function"&&o.onTouchStop(u,i),document.removeEventListener("touchmove",r.touchmove,!1),document.removeEventListener("touchend",r.touchstop,!1),document.removeEventListener("touchcancel",r.touchstop,!1)}Object.defineProperty(s,"__esModule",{value:!0}),s.mousedown=n,s.mousemove=d,s.mouseup=g,s.touchstart=T,s.touchmove=h,s.touchstop=c}])})})(A);const X=G(A.exports);class q{constructor(...e){__publicField(this,"target"),__publicField(this,"displace"),__publicField(this,"options");var t;this.target=((t=this.options)==null?void 0:t.handle)??e[0],this.options=e[1],this.displace=X(...e),this.destroy(),this.reinit=this.reinit.bind(this);const s=()=>{this.displace.reinit(),this.target.removeEventListener("mouseenter",s)};this.target.addEventListener("mouseenter",s),window.addEventListener("resize",this.reinit)}reinit(){this.displace.reinit()}destroy(){this.displace.destroy(),window.removeEventListener("resize",this.reinit)}changePosition(e,t){this.target.style.left=`${e}px`,this.target.style.top=`${t}px`}}class Y{constructor(e,t,s,n){__publicField(this,"serialize"),__publicField(this,"deserialize"),this.key=e,this.initialValue=t,this.storage=s,this.serialize=d=>n?.serialize?n.serialize(d):JSON.stringify(d),this.deserialize=d=>n?.deserialize?n.deserialize(d):JSON.parse(d)}get values(){try{const e=this.storage.getItem(this.key);return e?this.deserialize(e):this.initialValue}catch{return this.initialValue}}write(e){e instanceof Function&&(e=e(this.values));try{this.storage.setItem(this.key,this.serialize(e))}catch(t){return console.error(`Failed to save (${this.key}):`,t.message),this.initialValue}return e}reset(){this.write(this.initialValue)}}class _ extends Y{constructor(e,t,s){super(e,t,localStorage,s)}}class H{constructor(){__publicField(this,"el"),__publicField(this,"interact"),__publicField(this,"store",new _("position",{x:0,y:0}))}mount(e){this.el=I("div",{className:"overlay"},e),this.interact=new q(e,{constrain:!0,relativeTo:this.el,handle:e,onMouseDown:()=>{this.el.classList.add("grabbing")},onMouseUp:()=>{this.el.classList.remove("grabbing")},onMouseMove:t=>{const{x:s,y:n}=t.getBoundingClientRect();this.store.write({x:s,y:n})}}),this.updatePosition(),document.body.appendChild(this.el)}updatePosition(){const{x:e,y:t}=this.store.values;this.interact.changePosition(e,t)}}function k(a){return a<10?`0${a}`:`${a}`}const $=["minutes","seconds"];class K{constructor(){__publicField(this,"el"),__publicField(this,"seconds"),__publicField(this,"minutes"),__publicField(this,"inputClock",0),__publicField(this,"currentInput"),__publicField(this,"tempStore",new _("temp_timer",{minutes:0,seconds:0})),__publicField(this,"store",new _("timer",{minutes:0,seconds:0}))}get currentState(){return{type:this.currentInput.dataset.type,time:this.currentInput.textContent}}mount(){for(const e of $){const t=I("div",{contentEditable:"true"});t.dataset.type=e,t.addEventListener("keydown",s=>this.onKeyDown(s)),t.addEventListener("click",s=>{s.preventDefault(),this.focusInput(t)}),this[e]=t}this.updateInputValues(),this.el=I("div",{className:"timer"},this.minutes,":",this.seconds)}focusInput(e){this.currentInput=e,this.currentInput.focus(),this.updateInputClock(0)}onKeyDown(e){switch(e.preventDefault(),e.key){case"Enter":case"Escape":M.emit("timer_start",this.store.values),this.currentInput.blur();break;case"ArrowLeft":case"ArrowRight":this.navigateInput();break;case"ArrowUp":case"ArrowDown":this.incrementInputValue(e.key==="ArrowUp"?1:-1);break;default:if(Number.isNaN(parseInt(e.key)))return;this.changeInputValue(e.key)}}navigateInput(){const e=this.currentInput.nextElementSibling??this.currentInput.previousElementSibling;this.focusInput(e)}changeInputValue(e){const{type:t,time:s}=this.currentState,n=this.inputClock?s.slice(1)+e:s.slice(0,1)+e,d=this.parseTime(t,n);this.writeInputValues(t,d),this.updateInputClock()}incrementInputValue(e){const{type:t,time:s}=this.currentState,n=this.parseTime(t,s,e);this.writeInputValues(t,n)}writeInputValues(e,t){this[e].textContent=k(t),this.store.write(s=>({...s,[e]:t}))}updateInputClock(e){this.inputClock=e??(this.inputClock+1)%2}parseTime(e,t,s=0){let n=parseInt(t)+s;switch(e){case"minutes":n<0&&(n=99),n>99&&(n=0);break;case"seconds":n<0&&(n=59),n>59&&(n=0);break}return n}updateInputValues(e){const t=this.store.values;this.minutes.textContent=k(e?e.minutes:t.minutes),this.seconds.textContent=k(e?e.seconds:t.seconds),e&&this.tempStore.write(e)}}class j{constructor(){__publicField(this,"el"),__publicField(this,"container"),__publicField(this,"draggable"),__publicField(this,"timer")}mount(e,t){this.timer=t,this.draggable=e,this.container=I("div",{className:"widget-container"},this.timer.el),this.el=I("div",{className:"widget",onmouseenter:()=>{this.draggable.el.classList.add("moved")},onmouseleave:()=>{this.draggable.el.classList.remove("moved")},onauxclick:s=>{s.preventDefault()},oncontextmenu:s=>{s.preventDefault()}},this.container)}}const ie="";class J{constructor(){__publicField(this,"timer"),__publicField(this,"draggable"),__publicField(this,"widget"),__publicField(this,"countdown"),this.timer=new K,this.draggable=new H,this.widget=new j,this.countdown=new U}mount(){this.timer.mount(),this.widget.mount(this.draggable,this.timer),this.draggable.mount(this.widget.el),M.on("timer_start",e=>{this.countdown.setTime(e),this.countdown.start()}),M.on("timer_stop",()=>{this.countdown.stop()}),M.on("timer_tick",e=>{this.timer.updateInputValues(e)}),window.addEventListener("storage",e=>{switch(e.key){case"position":return this.draggable.updatePosition();case"timer":return this.timer.updateInputValues()}})}}new J().mount(),GM_addStyle(".overlay{left:0;top:0;width:100%;height:100%;cursor:grab}.overlay.moved{position:fixed}.overlay.grabbing{cursor:grabbing}.overlay .widget{z-index:999999;position:fixed!important;background-color:#1f1f23;width:70px;height:32px;box-shadow:0 6px 16px #00000080,0 0 4px #0006;border:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;align-items:center;justify-content:center}.overlay .widget-container{font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif;font-size:24px;color:#fff}.timer{display:flex;flex-direction:row}.timer div{display:block;text-align:center;caret-color:transparent}.timer div:focus{outline:none;color:tomato}")})();
